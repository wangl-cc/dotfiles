#!/bin/sh

echo "Sparse checkout to avoid README.md, LICENSE and install.sh in HOME"
rm -f ~/README.md ~/LICENSE ~/install.sh ~/.github
git -C "$HOME/.git" config core.sparsecheckout true
git -C "$HOME/.git" config core.sparseCheckoutCone false
cd ~ || exit 1 # sparse checkout must be run from the toplevel directory in non-cone mode
git sparse-checkout set --no-cone '/*' '!/README.md' '!/LICENSE' '!/install.sh' '!/.github'

bootstrap_dir="$(dirname "$0")/bootstrap.d"

if [ "$(uname -s)" = 'Darwin' ]; then
  bash "$bootstrap_dir/macOS.sh"
  # setup path to homebrew temporary to find packages installed by homebrew
  if [ "$(uname -m)" = 'arm64' ]; then
    export PATH="/opt/homebrew/bin:$PATH"
  else
    export PATH="/usr/local/bin:$PATH"
  fi
fi

if command -v fish >/dev/null 2>&1; then
  fish "$bootstrap_dir/fish.fish"
fi

# vim:ts=2:sw=2:et:fdm=marker
